<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Materias</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles/estilos.css' %}">
</head>

<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-dark mb-4">Gestión de Materias</h2>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <div class="card mb-4">
            <div class="card-header bg-dark text-white">Registrar Nueva Materia</div>
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="materia" class="form-label">Nombre de la Materia:</label>
                        <input type="text" name="materia" id="materia" class="form-control" value="{% if editar %}{{ materia_obj.materia }}{% else %}{{ '' }}{% endif %}" required>
                    </div>
                    <div class="mb-3">
                        <label for="codigo" class="form-label">Código:</label>
                        <input type="text" name="codigo" id="codigo" class="form-control" value="{% if editar %}{{ materia_obj.codigo }}{% else %}{{ '' }}{% endif %}" required>
                    </div>
                    <div class="mb-3">
                        <label for="creditos" class="form-label">Créditos:</label>
                        <input type="text" name="creditos" id="creditos" class="form-control" value="{% if editar %}{{ materia_obj.creditos }}{% else %}{{ '' }}{% endif %}" required>
                    </div>
                    <div class="mb-3">
                        <label for="metodologia" class="form-label">Metodología:</label>
                        <input type="text" name="metodologia" id="metodologia" class="form-control" value="{% if editar %}{{ materia_obj.metodologia }}{% else %}{{ '' }}{% endif %}">
                    </div>
                    <div class="mb-3">
                        <label for="horas" class="form-label">Total de Horas:</label>
                        <input type="text" name="horas" id="horas" class="form-control" value="{% if editar %}{{ materia_obj.horas }}{% else %}{{ '' }}{% endif %}">
                    </div>
                    <div class="mb-3">
                        <label for="programa" class="form-label">Programa:</label>
                        <select name="programa" id="programa" class="form-select" required>
                            <option value="" disabled selected>Seleccione un programa</option>
                            {% for programa in programas %}
                                <option value="{{ programa.id }}" {% if materia_obj.fk_programa.id == programa.id %}selected{% endif %}>{{ programa.programa }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="semestre" class="form-label">Semestre:</label>
                        <select name="semestre" id="semestre" class="form-select" required>
                            <option value="" disabled selected>Seleccione un semestre</option>
                            {% for semestre in semestres %}
                                <option value="{{ semestre.id }}" {% if materia_obj.fk_semestre.id == semestre.id %}selected{% endif %}>{{ semestre.semestre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="pensum" class="form-label">Pensum:</label>
                        <select name="pensum" id="pensum" class="form-select" required>
                            <option value="" disabled selected>Seleccione un pensum</option>
                            {% for pensum in pensums %}
                                <option value="{{ pensum.id }}" {% if materia_obj.fk_pensum.id == pensum.id %}selected{% endif %}>{{ pensum.pensum }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-dark">Guardar</button>
                </form>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header bg-dark text-white">Filtrar Materias</div>
            <div class="card-body">
                <form method="GET" class="row g-3">
                    <div class="col-md-5">
                        <label class="form-label">Programa:</label>
                        <select name="programa" class="form-select">
                            <option value="">Todos</option>
                            {% for programa in programas %}
                                <option value="{{ programa.id }}" {% if request.GET.programa == programa.id %}selected{% endif %}>{{ programa.programa }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-5">
                        <label class="form-label">Semestre:</label>
                        <select name="semestre" class="form-select">
                            <option value="">Todos</option>
                            {% for semestre in semestres %}
                                <option value="{{ semestre.id }}" {% if request.GET.semestre == semestre.id %}selected{% endif %}>{{ semestre.semestre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-outline-dark w-100">Buscar</button>
                    </div>
                </form>
            </div>
        </div>

        {% if request.GET.programa or request.GET.semestre %}
            <div class="card">
                <div class="card-header bg-dark text-white">Listado de Materias</div>
                <div class="card-body">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Código</th>
                                <th>Créditos</th>
                                <th>Metodología</th>
                                <th>Horas</th>
                                <th>Programa</th>
                                <th>Semestre</th>
                                <th>Pensum</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for materia in materias %}
                                <tr>
                                    <td>{{ materia.id }}</td>
                                    <td>{{ materia.materia }}</td>
                                    <td>{{ materia.codigo }}</td>
                                    <td>{{ materia.creditos }}</td>
                                    <td>{{ materia.metodologia }}</td>
                                    <td>{{ materia.horas }}</td>
                                    <td>{{ materia.fk_programa.programa }}</td>
                                    <td>{{ materia.fk_semestre.semestre }}</td>
                                    <td>{{ materia.fk_pensum.pensum }}</td>
                                    <td>
                                        <a href="{% url 'editar_materia' materia.id %}" class="btn btn-dark btn-sm">Editar</a>
                                        <a href="{% url 'eliminar_materia' materia.id %}" class="btn btn-danger btn-sm" onclick="return confirm('¿Deseas eliminar esta materia?');">Eliminar</a>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="10">No hay registros de materias para los filtros seleccionados.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}
    </div>
</body>
</html>
